<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - SledovÃ¡nÃ­ nÃ¡vykÅ¯</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ SledovÃ¡nÃ­ nÃ¡vykÅ¯</h1>
            <p class="subtitle">Buduj lepÅ¡Ã­ verzi sebe</p>
            <div class="user-info">
                <span>PÅ™ihlÃ¡Å¡en jako: <strong>{{ current_user.username }}</strong></span>
                <a href="{{ url_for('logout') }}" class="btn-logout">OdhlÃ¡sit se</a>
            </div>
            <nav>
                <a href="{{ url_for('index') }}" class="active">Dnes</a>
                <a href="{{ url_for('statistics') }}">Statistiky</a>
            </nav>
        </header>

        <main>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <!-- FormulÃ¡Å™ pro pÅ™idÃ¡nÃ­ novÃ©ho nÃ¡vyku -->
            <div class="add-habit-section">
                <h2>PÅ™idat novÃ½ nÃ¡vyk</h2>
                <form method="POST" action="{{ url_for('add_habit') }}" class="add-habit-form">
                    <input type="text" name="habit_name" placeholder="NÃ¡zev nÃ¡vyku (napÅ™. BÄ›hÃ¡nÃ­)" required>
                    <input type="number" name="target_per_week" placeholder="CÃ­l za tÃ½den (1-7)" min="1" max="7" value="7" required>
                    <button type="submit" class="btn btn-primary">PÅ™idat</button>
                </form>
                <p class="form-hint">ğŸ¯ Nastav, kolikrÃ¡t tÃ½dnÄ› chceÅ¡ aktivitu splnÄ›nÃ­ (1-7)</p>
            </div>

            <!-- Seznam nÃ¡vykÅ¯ -->
            <div class="habits-section">
                <h2>DneÅ¡nÃ­ nÃ¡vyky <span class="date">({{ today }})</span></h2>
                
                {% if habits %}
                    <div class="habits-grid">
                        {% for habit in habits %}
                            <div class="habit-card {% if habit.completed_today %}completed{% endif %}">
                                <div class="habit-header">
                                    <div class="habit-info">
                                        <div class="habit-target">{{ habit.week_count }}/{{ habit.target_per_week }}</div>
                                        <h3>{{ habit.name }}</h3>
                                    </div>
                                    <form method="POST" action="{{ url_for('delete_habit', habit_id=habit.id) }}" 
                                          onsubmit="return confirm('Opravdu smazat tento nÃ¡vyk?');">
                                        <button type="submit" class="btn-delete" title="Smazat">ğŸ—‘ï¸</button>
                                    </form>
                                </div>
                                
                                <div class="habit-stats">
                                    <span class="week-count">Tento tÃ½den: {{ habit.week_count }}/{{ habit.target_per_week }}</span>
                                    {% if habit.week_count >= habit.target_per_week %}
                                        <span class="goal-badge">âœ… CÃ­l splnÄ›n!</span>
                                    {% endif %}
                                </div>
                                
                                <button class="btn-toggle" data-habit-id="{{ habit.id }}" onclick="toggleHabit(this.dataset.habitId, this)">
                                    {% if habit.completed_today %}
                                        âœ… SplnÄ›no
                                    {% else %}
                                        â­• OznaÄit jako splnÄ›nÃ©
                                    {% endif %}
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>ğŸŒŸ ZatÃ­m nemÃ¡Å¡ Å¾Ã¡dnÃ© nÃ¡vyky.</p>
                        <p>ZaÄni pÅ™idÃ¡nÃ­m svÃ©ho prvnÃ­ho nÃ¡vyku vÃ½Å¡e!</p>
                    </div>
                {% endif %}
            </div>
        </main>
    </div>

    <script>
        function toggleHabit(habitId, button) {
            fetch(`/toggle_habit/${habitId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                const card = button.closest('.habit-card');
                if (data.completed) {
                    card.classList.add('completed');
                    button.innerHTML = 'âœ… SplnÄ›no';
                } else {
                    card.classList.remove('completed');
                    button.innerHTML = 'â­• OznaÄit jako splnÄ›nÃ©';
                }
                // Reload strÃ¡nky pro aktualizaci tÃ½dennÃ­ch statistik
                setTimeout(() => location.reload(), 500);
            });
        }
    </script>
</body>
</html>
