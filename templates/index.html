{% extends 'base.html' %}
{% from 'makra/macros.html' import habit_card, empty_state %}

{% block title %}Habit Tracker - SledovÃ¡nÃ­ nÃ¡vykÅ¯{% endblock %}

{% block header %}
    <header>
        <h1>ğŸ¯ SledovÃ¡nÃ­ nÃ¡vykÅ¯</h1>
        <p class="subtitle">Buduj lepÅ¡Ã­ verzi sebe</p>
        <div class="user-info">
            <span>PÅ™ihlÃ¡Å¡en jako: <strong>{{ current_user.username }}</strong></span>
            <a href="{{ url_for('logout') }}" class="btn-logout">OdhlÃ¡sit se</a>
        </div>
        <nav>
            <a href="{{ url_for('index') }}" class="active">Dnes</a>
            <a href="{{ url_for('statistics') }}">Statistiky</a>
        </nav>
    </header>
{% endblock %}

{% block content %}
    <!-- FormulÃ¡Å™ pro pÅ™idÃ¡nÃ­ novÃ©ho nÃ¡vyku -->
    <div class="add-habit-section">
        <h2>PÅ™idat novÃ½ nÃ¡vyk</h2>
        <form method="POST" action="{{ url_for('add_habit') }}" class="add-habit-form" novalidate>
            <input type="text" name="habit_name" placeholder="NÃ¡zev nÃ¡vyku (napÅ™. BÄ›hÃ¡nÃ­)" maxlength="100" pattern="^[a-zA-Z0-9\s\-Ä›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©]{1,100}$" required title="NÃ¡zev mÅ¯Å¾e mÃ­t 1-100 znakÅ¯">
            <input type="number" name="target_per_week" placeholder="CÃ­l za tÃ½den (1-7)" min="1" max="7" value="7" required>
            <button type="submit" class="btn btn-primary">PÅ™idat</button>
        </form>
        <p class="form-hint">ğŸ¯ Nastav, kolikrÃ¡t tÃ½dnÄ› chceÅ¡ aktivitu splnÄ›nÃ­ (1-7)</p>
    </div>

    <!-- Seznam nÃ¡vykÅ¯ -->
    <div class="habits-section">
        <h2>DneÅ¡nÃ­ nÃ¡vyky <span class="date">({{ today }})</span></h2>
        
        {% if habits %}
            <div class="habits-grid">
                {% for habit in habits %}
                    {{ habit_card(habit) }}
                {% endfor %}
            </div>
        {% else %}
            {{ empty_state('ğŸŒŸ', 'ZatÃ­m nemÃ¡Å¡ Å¾Ã¡dnÃ© nÃ¡vyky.', 'ZaÄni pÅ™idÃ¡nÃ­m svÃ©ho prvnÃ­ho nÃ¡vyku vÃ½Å¡e!') }}
        {% endif %}
    </div>

{% endblock %}

{% block extra_js %}
    <script>
        function toggleHabit(habitId, button) {
            fetch(`/toggle_habit/${habitId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                const card = button.closest('.habit-card');
                if (data.completed) {
                    card.classList.add('completed');
                    button.innerHTML = 'âœ… SplnÄ›no';
                } else {
                    card.classList.remove('completed');
                    button.innerHTML = 'â­• OznaÄit jako splnÄ›nÃ©';
                }
                // Reload strÃ¡nky pro aktualizaci tÃ½dennÃ­ch statistik
                setTimeout(() => location.reload(), 500);
            });
        }
    </script>
{% endblock %}

